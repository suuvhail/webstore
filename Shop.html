<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Page | Shop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>


  <style>
    @media (max-width: 767px) {
      #NomobileFilter {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white ">
    <div class="container">
      <a class="navbar-brand fw-bold fs-3" href="#">BISUM</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNavbar">
        <ul class="navbar-nav mx-auto gap-lg-3 text-uppercase small">
          <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Shop</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Blog</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
        </ul>

        <div class="d-flex gap-3 fs-5">
          <i class="bi bi-heart"></i>
          <i class="bi bi-bag"></i>
        </div>
      </div>
    </div>
  </nav>


  <section>
    <div class="container mt-5">
      <h1 class="text-center mb-5">shop</h1>
      <div class="row">
        <div class="col-md-3 mb-5" id="NomobileFilter" >
          <aside class="border-end pe-4">

            <!-- FILTER TITLE -->
            <h5 class="text-uppercase fw-bold mb-4">Filter</h5>

            <!-- GENDER FILTER -->
            <div class="mb-4">
              <h6 class="fw-semibold text-uppercase small mb-3">Gender</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="men" value="M">
                <label class="form-check-label" for="men">Men</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="women" value="W">
                <label class="form-check-label" for="women">Women</label>
              </div>
            </div>

            <!-- CATEGORY FILTER -->
            <div class="mb-4">
              <h6 class="fw-semibold text-uppercase small mb-3">Category</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="shoes" value="Shoes">
                <label class="form-check-label" for="shoes">Shoes</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="bags" value="bags">
                <label class="form-check-label" for="bags">Bags</label>
              </div>
            </div>

            <!-- PRICE FILTER -->
            <div class="mb-4">
              <h6 class="fw-semibold text-uppercase small mb-3">Price</h6>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="0-1000" id="price1">
                <label class="form-check-label" for="price1">Under 1000</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="1000-2000" id="price2">
                <label class="form-check-label" for="price2">1000 – 2000</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="2000+" id="price3">
                <label class="form-check-label" for="price3">Above 2000</label>
              </div>
            </div>

            <button class="btn btn-dark w-100">
              Apply Filters
            </button>
          </aside>
        </div>

        <div class="d-md-none mb-3">
          <button class="btn btn-outline-dark w-100" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas">
            Filter
          </button>
        </div>


        <div class="offcanvas offcanvas-start" tabindex="-1" id="filterOffcanvas">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title text-uppercase">Filter</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
          </div>

          <div class="offcanvas-body">

            <div class="mb-4">
              <h6 class="text-uppercase small fw-semibold mb-3">Gender</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="M" id="men-mob">
                <label class="form-check-label" for="men-mob">Men</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="W" id="women-mob">
                <label class="form-check-label" for="women-mob">Women</label>
              </div>
            </div>

            <div class="mb-4">
              <h6 class="text-uppercase small fw-semibold mb-3">Category</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="Shoes" id="shoes-mob">
                <label class="form-check-label" for="shoes-mob">Shoes</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="bags" id="bags-mob">
                <label class="form-check-label" for="bags-mob">Bags</label>
              </div>
            </div>

            <div class="mb-4">
              <h6 class="text-uppercase small fw-semibold mb-3">Price</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="0-1000">
                <label class="form-check-label">Under 1000</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="1000-2000">
                <label class="form-check-label">1000 – 2000</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="2000+">
                <label class="form-check-label">Above 2000</label>
              </div>
            </div>

            <button class="btn btn-dark w-100">
              Apply Filters
            </button>

          </div>
        </div>


        <div class="col-md-9">
          <div class="container">


            <div class="row" id="productsContainer">





            </div>

            <!--
            <nav aria-label="..." class="d-flex justify-content-center">
              <ul class="pagination">
                <li class="page-item" id="previous" value="prev">
                  <a href="#" class="page-link">Previous</a>
                </li>
                <li class="page-item active" id="page1" value="1">
                  <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item" id="page2" value="2">
                  <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item" id="page3" value="3">
                  <a class="page-link" href="#">3</a>
                </li>
                <li class="page-item" id="next" value="next">
                  <a class="page-link" href="#">Next</a>
                </li>
              </ul>
            </nav>
            -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <script src="./js/products.js"></script>

  <script type="module">
    // Assuming 'products' is imported or declared above
    const container = document.getElementById('productsContainer');
    const applyFilterBtn = document.querySelector('#filterOffcanvas .btn-dark');
  
    // 1. Shuffle function
    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }
  
    // 2. The Render Function
    // This replaces your old .forEach loop so we can call it multiple times
    function renderProducts(productsList) {
      container.innerHTML = ''; // Clear current view
  
      productsList.forEach(product => {
        const col = document.createElement('div');
        col.className = 'col-lg-4 col-sm-6 col-12 mb-4 product-card';
        
        col.innerHTML = `
          <div class="card border-0" style="height: 500px; display: flex; flex-direction: column;">
            <div class="position-relative flex-grow-1 overflow-hidden">
              <div class="position-absolute top-0 end-0 p-2 d-flex gap-2 z-1">
                <button class="btn btn-light btn-sm shadow-sm"><i class="bi bi-heart"></i></button>
                <button class="btn btn-light btn-sm shadow-sm"><i class="bi bi-bag"></i></button>
              </div>
              <div style="
                background-image: url('${product.images[0]}');
                background-size: cover;
                background-position: center;
                width: 100%;
                height: 100%;
              "></div>
            </div>
            <div class="text-center py-3 bg-white">
              <h6 class="mb-1 text-uppercase small" style="
                white-space: nowrap; 
                overflow: hidden; 
                text-overflow: ellipsis; 
                display: block;
                padding: 0 10px;
              ">${product.title}</h6>
              <p class="mb-2 fw-semibold">${product.prix} €</p>
              <a href="#" class="btn btn-outline-dark btn-sm">View</a>
            </div>
          </div>
        `;
        container.appendChild(col);
      });
    }
  
    // 3. The Filter Logic
    function handleFilters() {
      // Collect checked values
      const selectedGenders = Array.from(document.querySelectorAll('#filterOffcanvas input[id$="-mob"]:checked'))
                                   .filter(i => i.id.includes('men') || i.id.includes('women'))
                                   .map(i => i.value);
  
      const selectedCategories = Array.from(document.querySelectorAll('#filterOffcanvas input[id$="-mob"]:checked'))
                                       .filter(i => i.id.includes('shoes') || i.id.includes('bags'))
                                       .map(i => i.value.toLowerCase());
  
      const selectedPrices = Array.from(document.querySelectorAll('#filterOffcanvas input[value*="-"], #filterOffcanvas input[value*="+"]:checked'))
                                  .filter(i => i.checked)
                                  .map(i => i.value);
  
      // Filter the original array
      const filteredProducts = products.filter(product => {
        // Check Gender
        const matchesGender = selectedGenders.length === 0 || selectedGenders.includes(product.wOrm);
        
        // Check Category
        const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(product.category.toLowerCase());
  
        // Check Price
        let matchesPrice = selectedPrices.length === 0;
        if (selectedPrices.length > 0) {
          selectedPrices.forEach(range => {
            if (range === "0-1000" && product.prix <= 1000) matchesPrice = true;
            if (range === "1000-2000" && product.prix > 1000 && product.prix <= 2000) matchesPrice = true;
            if (range === "2000+" && product.prix > 2000) matchesPrice = true;
          });
        }
  
        return matchesGender && matchesCategory && matchesPrice;
      });
  
      // Render the new list
      renderProducts(filteredProducts);
  
      // Close the Bootstrap Offcanvas
      const offcanvasEl = document.getElementById('filterOffcanvas');
      const instance = bootstrap.Offcanvas.getInstance(offcanvasEl);
      if (instance) instance.hide();
    }
  
    // 4. Initialization
    // Shuffle and show all products on first load
    renderProducts(shuffleArray([...products]));
  
    // Listen for the "Apply Filters" button click
    applyFilterBtn.addEventListener('click', handleFilters);
  </script>

</body>

</html>