<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Page | Shop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>


  <style>
    @media (max-width: 767px) {
      #NomobileFilter {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white ">
    <div class="container">
      <a class="navbar-brand fw-bold fs-3" href="#">BISUM</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNavbar">
        <ul class="navbar-nav mx-auto gap-lg-3 text-uppercase small">
          <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Shop</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Blog</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
        </ul>

        <div class="d-flex gap-3 fs-5">
          <i class="bi bi-heart"></i>
          <i class="bi bi-bag"></i>
        </div>
      </div>
    </div>
  </nav>


  <section>
    <div class="container mt-5">
      <h1 class="text-center mb-5">shop</h1>
      <div class="row">
        <div class="col-md-3 mb-5" id="NomobileFilter">
          <aside class="border-end pe-4">

           
            <h5 class="text-uppercase fw-bold mb-4">Filter</h5>

          
            <div class="mb-4">
              <h6 class="fw-semibold text-uppercase small mb-3">Gender</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="men" value="M">
                <label class="form-check-label" for="men">Men</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="women" value="W">
                <label class="form-check-label" for="women">Women</label>
              </div>
            </div>

          
            <div class="mb-4">
              <h6 class="fw-semibold text-uppercase small mb-3">Category</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="shoes" value="Shoes">
                <label class="form-check-label" for="shoes">Shoes</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="bags" value="bags">
                <label class="form-check-label" for="bags">Bags</label>
              </div>
            </div>

           
            <div class="mb-4">
              <h6 class="fw-semibold text-uppercase small mb-3">Price</h6>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="0-1000" id="price1">
                <label class="form-check-label" for="price1">Under 1000</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="1000-2000" id="price2">
                <label class="form-check-label" for="price2">1000 – 2000</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="2000+" id="price3">
                <label class="form-check-label" for="price3">Above 2000</label>
              </div>
            </div>

            <button class="btn btn-dark w-100">
              Apply Filters 
            </button>
          </aside>
        </div>

        <div class="d-md-none mb-3">
          <button class="btn btn-outline-dark w-100" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas">
            Open Filter Menu
          </button>
        </div>


        <div class="offcanvas offcanvas-start" tabindex="-1" id="filterOffcanvas">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title text-uppercase">Filter</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
          </div>

          <div class="offcanvas-body">

            <div class="mb-4">
              <h6 class="text-uppercase small fw-semibold mb-3">Gender</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="M" id="men-mob">
                <label class="form-check-label" for="men-mob">Men</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="W" id="women-mob">
                <label class="form-check-label" for="women-mob">Women</label>
              </div>
            </div>

            <div class="mb-4">
              <h6 class="text-uppercase small fw-semibold mb-3">Category</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="Shoes" id="shoes-mob">
                <label class="form-check-label" for="shoes-mob">Shoes</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="bags" id="bags-mob">
                <label class="form-check-label" for="bags-mob">Bags</label>
              </div>
            </div>

            <div class="mb-4">
              <h6 class="text-uppercase small fw-semibold mb-3">Price</h6>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="0-1000">
                <label class="form-check-label">Under 1000</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="1000-2000">
                <label class="form-check-label">1000 – 2000</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="2000+">
                <label class="form-check-label">Above 2000</label>
              </div>
            </div>

            <button class="btn btn-dark w-100">
              Apply Filters 
            </button>

          </div>
        </div>


        <div class="col-md-9">
          <div class="container">


            <div class="row" id="productsContainer">

            </div>


          </div>
        </div>
      </div>
    </div>
  </section>

  <script src="./js/products.js"></script>

  <script type="module">
    const container = document.getElementById('productsContainer');
    let filteredProducts = [...products];

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    window.clearAllFilters = function () {
      document.querySelectorAll('#NomobileFilter input[type="checkbox"]').forEach(input => {
        input.checked = false;
      });

      document.querySelectorAll('#filterOffcanvas input[type="checkbox"]').forEach(input => {
        input.checked = false;
      });

      filteredProducts = shuffleArray([...products]);
      renderProducts(filteredProducts);
    };

    // la mas importante aqui es para mostrar los dato de productos de forma HTML usando js -_- ME
    function renderProducts(productsList) {
      container.innerHTML = '';

      if (productsList.length === 0) {
        container.innerHTML = `
          <div class="col-12 text-center py-5">
            <p class="text-muted">No products found matching your filters.</p>
            <button class="btn btn-outline-dark" onclick="clearAllFilters()">Clear All Filters</button>
          </div>
        `;
        return;
      }

      productsList.forEach(product => {
        const col = document.createElement('div');
        col.className = 'col-lg-4 col-sm-6 col-12 mb-4 product-card';

        col.innerHTML = `
          <div class="card border-0" style="height: 500px; display: flex; flex-direction: column;">
            <div class="position-relative flex-grow-1 overflow-hidden">
              <div class="position-absolute top-0 end-0 p-2 d-flex gap-2 z-1">
                <button class="btn btn-light btn-sm shadow-sm"><i class="bi bi-heart"></i></button>
                <button class="btn btn-light btn-sm shadow-sm"><i class="bi bi-bag"></i></button>
              </div>
              <div style="
                background-image: url('${product.images[0]}');
                background-size: cover;
                background-position: center;
                width: 100%;
                height: 100%;
              "></div>
            </div>
            <div class="text-center py-3 bg-white">
              <h6 class="mb-1 text-uppercase small" style="
                white-space: nowrap; 
                overflow: hidden; 
                text-overflow: ellipsis; 
                display: block;
                padding: 0 10px;
              ">${product.title}</h6>
              <p class="mb-2 fw-semibold">${product.prix} €</p>
              <a href="#" class="btn btn-outline-dark btn-sm">View</a>
            </div>
          </div>
        `;
        container.appendChild(col);
      });
    }

    // la funcion que es responsable de obtener los filtros parametro y mostrar los filtros para aplicar -_-
    function getActiveFilters() {
      const desktopGenders = Array.from(document.querySelectorAll('#NomobileFilter input[id="men"]:checked, #NomobileFilter input[id="women"]:checked'))
        .map(input => input.value);

      const desktopCategories = Array.from(document.querySelectorAll('#NomobileFilter input[id="shoes"]:checked, #NomobileFilter input[id="bags"]:checked'))
        .map(input => input.value.toLowerCase());

      const desktopPrices = Array.from(document.querySelectorAll('#NomobileFilter input[value="0-1000"]:checked, #NomobileFilter input[value="1000-2000"]:checked, #NomobileFilter input[value="2000+"]:checked'))
        .map(input => input.value);

      const mobileGenders = Array.from(document.querySelectorAll('#filterOffcanvas input[id="men-mob"]:checked, #filterOffcanvas input[id="women-mob"]:checked'))
        .map(input => input.value);

      const mobileCategories = Array.from(document.querySelectorAll('#filterOffcanvas input[id="shoes-mob"]:checked, #filterOffcanvas input[id="bags-mob"]:checked'))
        .map(input => input.value.toLowerCase());

      const mobilePrices = Array.from(document.querySelectorAll('#filterOffcanvas input[value="0-1000"]:checked, #filterOffcanvas input[value="1000-2000"]:checked, #filterOffcanvas input[value="2000+"]:checked'))
        .map(input => input.value);

      let genders = desktopGenders;
      let categories = desktopCategories;
      let prices = desktopPrices;

      if (desktopGenders.length === 0 && mobileGenders.length > 0) genders = mobileGenders;
      if (desktopCategories.length === 0 && mobileCategories.length > 0) categories = mobileCategories;
      if (desktopPrices.length === 0 && mobilePrices.length > 0) prices = mobilePrices;

      return {
        genders: genders,
        categories: categories,
        prices: prices
      };
    }

    function matchesPrice(productPrice, priceRanges) {
      if (priceRanges.length === 0) return true;

      return priceRanges.some(range => {
        if (range === "0-1000") return productPrice <= 1000;
        if (range === "1000-2000") return productPrice > 1000 && productPrice <= 2000;
        if (range === "2000+") return productPrice > 2000;
        return false;
      });
    }

    // aqui applicamos los filtros obteniendo desde la function preUltima se llama getActiveFilter
    function applyFilters() {
      const filters = getActiveFilters();

      if (filters.genders.length === 0 &&
        filters.categories.length === 0 &&
        filters.prices.length === 0) {
        filteredProducts = shuffleArray([...products]);
        renderProducts(filteredProducts);
        return;
      }

      filteredProducts = products.filter(product => {
        const matchesGender = filters.genders.length === 0 ||
          filters.genders.includes(product.wOrm);

        const matchesCategory = filters.categories.length === 0 ||
          filters.categories.includes(product.category.toLowerCase());

        const matchesPriceFilter = matchesPrice(product.prix, filters.prices);

        return matchesGender && matchesCategory && matchesPriceFilter;
      });

      renderProducts(filteredProducts);
    }

 
    function handleDesktopFilter() {
      applyFilters();
    }

   
    function handleMobileFilter() {
      applyFilters();

    
      const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('filterOffcanvas'));
      if (offcanvas) offcanvas.hide();
    }

    // aqui usamos el addEventos para que los botóns van a trabajar
    document.addEventListener('DOMContentLoaded', function () {
    
      const desktopApplyBtn = document.querySelector('#NomobileFilter .btn-dark');
      if (desktopApplyBtn) {
        desktopApplyBtn.addEventListener('click', handleDesktopFilter);
      }

      
      const mobileApplyBtn = document.querySelector('#filterOffcanvas .btn-dark');
      if (mobileApplyBtn) {
        mobileApplyBtn.addEventListener('click', handleMobileFilter);
      }
    });

   
    filteredProducts = shuffleArray([...products]);
    renderProducts(filteredProducts);
  </script>

</body>

</html>